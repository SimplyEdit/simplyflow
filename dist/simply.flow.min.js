(()=>{var J=Object.defineProperty;var V=(e,t)=>{for(var n in t)J(e,n,{get:t[n],enumerable:!0})};var I={};V(I,{batch:()=>H,clockEffect:()=>_,destroy:()=>q,effect:()=>v,signal:()=>A,throttledEffect:()=>z,untracked:()=>ee});var O=Symbol("iterate");Symbol.xRay||(Symbol.xRay=Symbol("xRay"));var Q={get:(e,t,n)=>{if(t===Symbol.xRay)return e;let r=e?.[t];return P(n,t),typeof r=="function"?Array.isArray(e)?(...i)=>{let s=e.length,l=r.apply(n,i);return s!=e.length&&E(n,w("length",{was:s,now:e.length})),l}:e instanceof Set||e instanceof Map?(...i)=>{let s=e.size,l=r.apply(e,i);return s!=e.size&&E(n,w("size",{was:s,now:e.size})),["set","add","clear","delete"].includes(t)&&E(n,w({entries:{},forEach:{},has:{},keys:{},values:{},[Symbol.iterator]:{}})),l}:e instanceof HTMLElement||e instanceof Number||e instanceof String||e instanceof Boolean?r.bind(e):r.bind(n):r&&typeof r=="object"?A(r):r},set:(e,t,n,r)=>{n=n?.[Symbol.xRay]||n;let i=e[t];return i!==n&&(e[t]=n,E(r,w(t,{was:i,now:n}))),typeof i>"u"&&E(r,w(O,{})),!0},has:(e,t)=>{let n=g.get(e);return n&&P(n,t),Object.hasOwn(e,t)},deleteProperty:(e,t)=>{if(typeof e[t]<"u"){let n=e[t];delete e[t];let r=g.get(e);E(r,w(t,{delete:!0,was:n}))}return!0},defineProperty:(e,t,n)=>{if(typeof e[t]>"u"){let r=g.get(e);E(r,w(O,{}))}return Object.defineProperty(e,t,n)},ownKeys:e=>{let t=g.get(e);return P(t,O),Reflect.ownKeys(e)}},g=new WeakMap;function A(e){return g.has(e)||g.set(e,new Proxy(e,Q)),g.get(e)}var L=new Set,k=0;function E(e,t={}){let n=[];if(t.forEach((r,i)=>{let s=Y(e,i);if(s?.length){for(let l of s)X(l,w(i,r));n=n.concat(s)}}),n=new Set(n.filter(Boolean)),n)if(k)L=L.union(n);else{let r=b[b.length-1];for(let i of Array.from(n))i!=r&&i?.needsUpdate&&i(),D(i)}}function w(e,t){let n=new Map;if(typeof e=="object")for(let r in e)n.set(r,e[r]);else n.set(e,t);return n}function X(e,t){e.context?t.forEach((n,r)=>{e.context.set(r,n)}):e.context=t,e.needsUpdate=!0}function D(e){delete e.context,delete e.needsUpdate}function P(e,t){let n=b[b.length-1];n&&Z(e,t,n)}var M=new WeakMap,B=new WeakMap;function Y(e,t){let n=M.get(e);return n?Array.from(n.get(t)||[]):[]}function Z(e,t,n){M.has(e)||M.set(e,new Map);let r=M.get(e);r.has(t)||r.set(t,new Set),r.get(t).add(n),B.has(n)||B.set(n,new Map);let i=B.get(n);i.has(t)||i.set(t,new Set),i.get(t).add(e)}function $(e){let t=B.get(e);t&&t.forEach(n=>{n.forEach(r=>{let i=M.get(r);i.has(n)&&i.get(n).delete(e)})})}var b=[],C=[],j=new WeakMap,T=[];function v(e){if(C.findIndex(r=>e==r)!==-1)throw new Error("Recursive update() call",{cause:e});C.push(e);let t=g.get(e);t||(t=A({current:null}),g.set(e,t));let n=function r(){if(T.findIndex(s=>s==t)!==-1)throw new Error("Cyclical dependency in update() call",{cause:e});$(r),b.push(r),T.push(t);let i;try{i=e(r,b,T)}finally{b.pop(),T.pop(),i instanceof Promise?i.then(s=>{t.current=s}):t.current=i}};return n.fn=e,j.set(t,n),n(),t}function q(e){let t=j.get(e)?.deref();if(!t)return;$(t);let n=t.fn;g.remove(n),j.delete(e)}function H(e){k++;let t;try{t=e()}finally{t instanceof Promise?t.then(()=>{k--,k||W()}):(k--,k||W())}return t}function W(){let e=Array.from(L);L=new Set;let t=b[b.length-1];for(let n of e)n!=t&&n?.needsUpdate&&n(),D(n)}function z(e,t){if(C.findIndex(l=>e==l)!==-1)throw new Error("Recursive update() call",{cause:e});C.push(e);let n=g.get(e);n||(n=A({current:null}),g.set(e,n));let r=!1,i=!0;return function l(){if(T.findIndex(a=>a==n)!==-1)throw new Error("Cyclical dependency in update() call",{cause:e});if(r&&r>Date.now()){i=!0;return}$(l),b.push(l),T.push(n);let o;try{o=e(l,b,T)}finally{i=!1,b.pop(),T.pop(),o instanceof Promise?o.then(a=>{n.current=a}):n.current=o}r=Date.now()+t,globalThis.setTimeout(()=>{i&&l()},t)}(),n}function _(e,t){let n=g.get(e);n||(n=A({current:null}),g.set(e,n));let r=-1,i=!0;return function l(){if(r<t.time)if(i){$(l),b.push(l),r=t.time;let o;try{o=e(l,b)}finally{b.pop(),o instanceof Promise?o.then(a=>{n.current=a}):n.current=o,i=!1}}else r=t.time;else i=!0}(),n}function ee(e){let t=b.slice();b=[];try{return e()}finally{b=t}}var R=class{constructor(t){this.bindings=new Map;let n={container:document.body,attribute:"data-bind",transformers:[],defaultTransformers:{field:[te],list:[ne],map:[re]}};if(!t?.root)throw new Error("bind needs at least options.root set");this.options=Object.assign({},n,t);let r=this.options.attribute,i=[r+"-field",r+"-list",r+"-map"],s=`[${r}-field],[${r}-list],[${r}-map]`,l=c=>{let f=i.find(m=>c.hasAttribute(m));return f||console.error("No matching attribute found",c),f},o=c=>{this.bindings.set(c,z(()=>{let f={templates:c.querySelectorAll(":scope > template"),attribute:l(c)};f.path=this.getBindingPath(c),f.value=N(this.options.root,f.path),f.element=c,a(f)},100))},a=c=>{let f;switch(c.attribute){case this.options.attribute+"-field":f=this.options.defaultTransformers.field||[];break;case this.options.attribute+"-list":f=this.options.defaultTransformers.list||[];break;case this.options.attribute+"-map":f=this.options.defaultTransformers.map||[];break}c.element.dataset.transform&&c.element.dataset.transform.split(" ").filter(Boolean).forEach(d=>{this.options.transformers[d]?f.push(this.options.transformers[d]):console.warn("No transformer with name "+d+" configured",{cause:c.element})});let m;for(let d of f)m=((y,x)=>G=>x.call(this,G,y))(m,d);m(c)},p=c=>{for(let f of c)o(f)},u=c=>{let f=`[${r}-field],[${r}-list],[${r}-map]`;for(let m of c)if(m.type=="childList"&&m.addedNodes){for(let d of m.addedNodes)if(d instanceof HTMLElement){let y=Array.from(d.querySelectorAll(f));d.matches(f)&&y.unshift(d),y.length&&p(y)}}};this.observer=new MutationObserver(c=>{u(c)}),this.observer.observe(t.container,{subtree:!0,childList:!0});let h=this.options.container.querySelectorAll(":is(["+this.options.attribute+"-field],["+this.options.attribute+"-list],["+this.options.attribute+"-map]):not(template)");h.length&&p(h)}applyTemplate(t){let n=t.path,r=t.templates,i=t.list,s=t.index,l=t.parent,o=i?i[s]:t.value,a=this.findTemplate(r,o);if(!a){let f=new DocumentFragment;return f.innerHTML="<!-- no matching template -->",f}let p=a.content.cloneNode(!0);if(!p.children?.length)return p;if(p.children.length>1)throw new Error("template must contain a single root node",{cause:a});let u=this.options.attribute,h=[u+"-field",u+"-list",u+"-map"],c=p.querySelectorAll(`[${u}-field],[${u}-list],[${u}-map]`);for(let f of c){let m=h.find(y=>f.hasAttribute(y)),d=f.getAttribute(m);d.substring(0,6)==":root."?f.setAttribute(m,d.substring(6)):d==":value"&&s!=null?f.setAttribute(m,n+"."+s):s!=null?f.setAttribute(m,n+"."+s+"."+d):f.setAttribute(m,l+"."+d)}return typeof s<"u"&&p.children[0].setAttribute(u+"-key",s),p.children[0].$bindTemplate=a,p}getBindingPath(t){let n=[this.options.attribute+"-field",this.options.attribute+"-list",this.options.attribute+"-map"];for(let r of n)if(t.hasAttribute(r))return t.getAttribute(r)}findTemplate(t,n){let r=l=>{let o=this.getBindingPath(l),a;o?o.substr(0,6)==":root."?a=N(this.options.root,o):a=N(n,o):a=n;let p=""+a,u=l.getAttribute(this.options.attribute+"-match");if(u){if(u===":empty"&&!a)return l;if(u===":notempty"&&a||p.match(u))return l}if(!u&&a!==null&&a!==void 0)return l},i=Array.from(t).find(r),s=i?.getAttribute("rel");if(s){let l=document.querySelector("template#"+s);if(!l)throw new Error("Could not find template with id "+s);i=l}return i}destroy(){this.bindings.forEach(t=>{q(t)}),this.bindings=new Map,this.observer.disconnect()}};function F(e){return new R(e)}function S(e,t){return e==":empty"&&!t||t==":empty"&&!e||""+e==""+t}function N(e,t){let n=t.split("."),r=e,i,s;for(;n.length&&r;){if(i=n.shift(),i==":key")return s;if(i==":value")return r;i==":root"?r=e:(i=decodeURIComponent(i),r=r[i],s=i)}return r}function te(e){let t=e.element,n=e.templates,r=n.length,i=e.path,s=e.value,l=this.options.attribute;if(n?.length)oe.call(this,e);else switch(t.tagName){case"INPUT":ae.call(this,e);break;case"BUTTON":fe.call(this,e);break;case"SELECT":ce.call(this,e);break;case"A":ue.call(this,e);break;case"TEMPLATE":break;default:pe.call(this,e);break}return e}function ne(e){let t=e.element,n=e.templates,r=n.length,i=e.path,s=e.value,l=this.options.attribute;return Array.isArray(s)?n?.length?ie.call(this,e):console.error("No templates found in",t):console.error("Value is not an array.",t,s),e}function re(e){let t=e.element,n=e.templates,r=n.length,i=e.path,s=e.value,l=this.options.attribute;return typeof s!="object"?console.error("Value is not an object.",t,s):n?.length?se.call(this,e):console.error("No templates found in",t),e}function ie(e){let t=e.element,n=e.templates,r=n.length,i=e.path,s=e.value,l=this.options.attribute,o=t.querySelectorAll(":scope > ["+l+"-key]"),a=0,p=0;e.list=s;for(let h of o){let c=parseInt(h.getAttribute(l+"-key"));if(c>a)e.index=a,t.insertBefore(this.applyTemplate(e),h);else if(c<a)h.remove();else{let f=Array.from(h.querySelectorAll(`[${l}]`));h.matches(`[${l}]`)&&f.unshift(h);let m=f.find(d=>{let y=d.getAttribute(l);return y.substr(0,5)!==":root"&&y.substr(0,i.length)!==i});if(!m&&h.$bindTemplate){let d=this.findTemplate(n,s[a]);d!=h.$bindTemplate&&(m=!0,d||p++)}m&&(e.index=a,t.replaceChild(this.applyTemplate(e),h))}if(a++,a>=s.length)break}o=t.querySelectorAll(":scope > ["+l+"-key]");let u=o.length+p;if(u>s.length)for(;u>s.length;)t.querySelectorAll(":scope > :not(template)")?.[u-1]?.remove(),u--;else if(u<s.length)for(;u<s.length;)e.index=u,t.appendChild(this.applyTemplate(e)),u++}function se(e){let t=e.element,n=e.templates,r=n.length,i=e.path,s=e.value,l=this.options.attribute;e.list=s;let o=Array.from(t.querySelectorAll(":scope > ["+l+"-key]"));for(let a in e.list){e.index=a;let p=o.shift();if(!p){let h=this.applyTemplate(e);t.appendChild(h);continue}if(p.getAttribute[l+"-key"]!=a){o.unshift(p);let h=t.querySelector(":scope > ["+l+'-key="'+a+'"]');if(h)t.insertBefore(h,p),p=h,o=o.filter(c=>c!=h);else{let c=this.applyTemplate(e);t.insertBefore(c,p);continue}}if(this.findTemplate(n,s[a])!=p.$bindTemplate){let h=this.applyTemplate(e);t.replaceChild(h,p)}}for(;o.length;)o.shift().remove()}function le(e,t){let n=e.parentElement?.closest(`[${t}-list],[${t}-map]`);return n?n.hasAttribute(`${t}-list`)?n.getAttribute(`${t}-list`):n.getAttribute(`${t}-map`):":root"}function oe(e){let t=e.element,n=e.templates,r=e.value,i=this.options.attribute,s=t.querySelector(":scope > :not(template)"),l=this.findTemplate(n,r);if(e.parent=le(t,i),s)if(l){if(s?.$bindTemplate!=l){let o=this.applyTemplate(e);t.replaceChild(o,s)}}else t.removeChild(s);else if(l){let o=this.applyTemplate(e);t.appendChild(o)}}function ae(e){let t=e.element,n=e.value;t.type=="checkbox"||t.type=="radio"?S(t.value,n)?t.checked=!0:t.checked=!1:S(t.value,n)||(t.value=""+n)}function fe(e){let t=e.element,n=e.value;S(t.value,n)||(t.value=""+n)}function ce(e){let t=e.element,n=e.value;if(t.multiple){if(Array.isArray(n))for(let r of t.options)n.indexOf(r.value)===!1?r.selected=!1:r.selected=!0}else{let r=t.options.find(i=>S(i.value,n));r&&(r.selected=!0)}}function ue(e){let t=e.element,n=e.value;n?.innerHTML&&!S(t.innerHTML,n.innerHTML)&&(t.innerHTML=""+n.innerHTML),n?.href&&!S(t.href,n.href)&&(t.href=""+n.href)}function pe(e){let t=e.element,n=e.value;S(t.innerHTML,n)||(typeof n>"u"||n==null?t.innerHTML="":t.innerHTML=""+n)}var K={};V(K,{columns:()=>ge,filter:()=>be,model:()=>he,paging:()=>me,scroll:()=>ye,sort:()=>de});var U=class{constructor(t){this.state=A(t),this.state.options||(this.state.options={}),this.effects=[{current:t.data}],this.view=A(t.data)}addEffect(t){let n=this.effects[this.effects.length-1];this.view=t.call(this,n),this.effects.push(this.view)}};function he(e){return new U(e)}function de(e={}){return function(t){return this.state.options.sort=Object.assign({direction:"asc",sortBy:null,sortFn:(n,r)=>{let i=this.state.options.sort,s=i.sortBy;if(!i.sortBy)return 0;let l=i.direction=="asc"?1:-1,o=i.direction=="asc"?-1:1;return typeof n?.[s]>"u"?typeof r?.[s]>"u"?0:l:typeof r?.[s]>"u"||n[s]<r[s]?o:n[s]>r[s]?l:0}},e),v(()=>{let n=this.state.options.sort;return n?.sortBy&&n?.direction?t.current.toSorted(n?.sortFn):t.current})}}function me(e={}){return function(t){return this.state.options.paging=Object.assign({page:1,pageSize:20,max:1},e),v(()=>H(()=>{let n=this.state.options.paging;n.pageSize||(n.pageSize=20),n.max=Math.ceil(this.state.data.length/n.pageSize),n.page=Math.max(1,Math.min(n.max,n.page));let r=(n.page-1)*n.pageSize,i=r+n.pageSize;return t.current.slice(r,i)}))}}function be(e){if(!e?.name||typeof e.name!="string")throw new Error("filter requires options.name to be a string");if(!e.matches||typeof e.matches!="function")throw new Error("filter requires options.matches to be a function");return function(t){return this.state.options[e.name]=e,v(()=>{if(this.state.options[e.name].enabled)return t.filter(this.state.options[e.name].matches)})}}function ge(e={}){if(!e||typeof e!="object"||Object.keys(e).length===0)throw new Error("columns requires options to be an object with at least one property");return function(t){return this.state.options.columns=e,v(()=>t.current.map(n=>{let r={};for(let i of Object.keys(this.state.options.columns))this.state.options.columns[i]?.hidden||(r[i]=n[i]);return r}))}}function ye(e){if(!e.container)throw new Error("scroll needs a container option to calculate the number of visible rows");return function(t){this.state.options.scroll=Object.assign({offset:0,rowHeight:26},e);let n=this.state.options.scroll,r=n.scrollbar||n.container.querySelector("[data-flow-scrollbar]");if(!r)throw new Error('scroll needs a scrollbar, or an element with the attribute "data-flow-scrollbar"');return n.container.addEventListener("scroll",i=>{n.offset=Math.floor(n.container.scrollTop/n.rowHeight),console.log("scrolling",n.offset)}),v(()=>{let i=t.current.length*n.rowHeight;r.style.height=i+"px"}),v(()=>{n.rows=Math.ceil(n.container.getBoundingClientRect().height/n.rowHeight),n.data=t.current;let i=Math.min(n.offset,t.current.length-1),s=i+n.rows;return s>t.current.length&&(s=t.current.length,i=s-n.rows),console.log("virtual scroll",i,s),t.current.slice(i,s)})}}window.simply||(window.simply={});Object.assign(window.simply,{bind:F,flow:K,state:I});var Se=window.simply;})();
//# sourceMappingURL=simply.flow.min.js.map
