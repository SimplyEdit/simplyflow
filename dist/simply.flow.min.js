(()=>{var ne=Object.defineProperty;var D=(e,t)=>{for(var n in t)ne(e,n,{get:t[n],enumerable:!0})};var F={};D(F,{batch:()=>H,clockEffect:()=>X,destroy:()=>q,effect:()=>Q,signal:()=>T,throttledEffect:()=>w,trace:()=>re,untracked:()=>oe});var R=Symbol("iterate");Symbol.xRay||(Symbol.xRay=Symbol("xRay"));Symbol.Signal||(Symbol.Signal=Symbol("Signal"));var ie={get:(e,t,n)=>{if(t===Symbol.xRay)return e;if(t===Symbol.Signal)return!0;let i=e?.[t];return z(n,t),typeof i=="function"?Array.isArray(e)?(...r)=>{let s=e.length,l=i.apply(n,r);return s!=e.length&&v(n,S("length",{was:s,now:e.length})),l}:e instanceof Set||e instanceof Map?(...r)=>{let s=e.size,l=i.apply(e,r);return s!=e.size&&v(n,S("size",{was:s,now:e.size})),["set","add","clear","delete"].includes(t)&&v(n,S({entries:{},forEach:{},has:{},keys:{},values:{},[Symbol.iterator]:{}})),l}:e instanceof HTMLElement||e instanceof Number||e instanceof String||e instanceof Boolean?i.bind(e):i.bind(n):i&&typeof i=="object"?T(i):i},set:(e,t,n,i)=>{n=n?.[Symbol.xRay]||n;let r=e[t];return r!==n&&(e[t]=n,v(i,S(t,{was:r,now:n}))),typeof r>"u"&&v(i,S(R,{})),!0},has:(e,t)=>{let n=b.get(e);return n&&z(n,t),Object.hasOwn(e,t)},deleteProperty:(e,t)=>{if(typeof e[t]<"u"){let n=e[t];delete e[t];let i=b.get(e);v(i,S(t,{delete:!0,was:n}))}return!0},defineProperty:(e,t,n)=>{if(typeof e[t]>"u"){let i=b.get(e);v(i,S(R,{}))}return Object.defineProperty(e,t,n)},ownKeys:e=>{let t=b.get(e);return z(t,R),Reflect.ownKeys(e)}},b=new WeakMap;function T(e){if(e[Symbol.Signal]){let t=e[Symbol.xRay];b.has(t)||b.set(t,e),e=t}else b.has(e)||b.set(e,new Proxy(e,ie));return b.get(e)}function re(e,t){return J(e,t).map(i=>({effect:i.effectType,fn:i.effectFunction,signal:b.get(i.effectFunction)}))}var P=new Set,M=0;function v(e,t={}){let n=[];if(t.forEach((i,r)=>{let s=J(e,r);if(s?.length){for(let l of s)se(l,S(r,i));n=n.concat(s)}}),n=new Set(n.filter(Boolean)),n)if(M)P=P.union(n);else{let i=m[m.length-1];for(let r of Array.from(n))r!=i&&r?.needsUpdate&&r(),x(r)}}function S(e,t){let n=new Map;if(typeof e=="object")for(let i in e)n.set(i,e[i]);else n.set(e,t);return n}function se(e,t){e.context?t.forEach((n,i)=>{e.context.set(i,n)}):e.context=t,e.needsUpdate=!0}function x(e){delete e.context,delete e.needsUpdate}function z(e,t){let n=m[m.length-1];n&&le(e,t,n)}var B=new WeakMap,j=new WeakMap;function J(e,t){let n=B.get(e);return n?Array.from(n.get(t)||[]):[]}function le(e,t,n){B.has(e)||B.set(e,new Map);let i=B.get(e);i.has(t)||i.set(t,new Set),i.get(t).add(n),j.has(n)||j.set(n,new Map);let r=j.get(n);r.has(t)||r.set(t,new Set),r.get(t).add(e)}function L(e){let t=j.get(e);t&&t.forEach(n=>{n.forEach(i=>{let r=B.get(i);r.has(n)&&r.get(n).delete(e)})})}var m=[],$=[],N=new WeakMap,A=[];function Q(e){if($.findIndex(i=>e==i)!==-1)throw new Error("Recursive update() call",{cause:e});$.push(e);let t=b.get(e);t||(t=T({current:null}),b.set(e,t));let n=function i(){if(A.findIndex(s=>s==t)!==-1)throw new Error("Cyclical dependency in update() call",{cause:e});L(i),i.effectFunction=e,i.effectType=Q,m.push(i),A.push(t);let r;try{r=e(i,m,A)}finally{m.pop(),A.pop(),r instanceof Promise?r.then(s=>{t.current=s}):t.current=r}};return n.fn=e,N.set(t,n),n(),t}function q(e){let t=N.get(e)?.deref();if(!t)return;L(t);let n=t.fn;b.remove(n),N.delete(e)}function H(e){M++;let t;try{t=e()}finally{t instanceof Promise?t.then(()=>{M--,M||G()}):(M--,M||G())}return t}function G(){let e=Array.from(P);P=new Set;let t=m[m.length-1];for(let n of e)n!=t&&n?.needsUpdate&&n(),x(n)}function w(e,t){if($.findIndex(l=>e==l)!==-1)throw new Error("Recursive update() call",{cause:e});$.push(e);let n=b.get(e);n||(n=T({current:null}),b.set(e,n));let i=!1,r=!0;return function l(){if(A.findIndex(f=>f==n)!==-1)throw new Error("Cyclical dependency in update() call",{cause:e});if(i&&i>Date.now()){r=!0;return}L(l),l.effectFunction=e,l.effectType=w,m.push(l),A.push(n);let a;try{a=e(l,m,A)}finally{r=!1,m.pop(),A.pop(),a instanceof Promise?a.then(f=>{n.current=f}):n.current=a}i=Date.now()+t,globalThis.setTimeout(()=>{r&&l()},t)}(),n}function X(e,t){let n=b.get(e);n||(n=T({current:null}),b.set(e,n));let i=-1,r=!0;return function l(){if(i<t.time)if(r){L(l),l.effectFunction=e,l.effectType=X,m.push(l),i=t.time;let a;try{a=e(l,m)}finally{m.pop(),a instanceof Promise?a.then(f=>{n.current=f}):n.current=a,r=!1}}else i=t.time;else r=!0}(),n}function oe(e){let t=m.slice();m=[];try{return e()}finally{m=t}}var V=class{constructor(t){this.bindings=new Map;let n={container:document.body,attribute:"data-bind",transformers:{},defaultTransformers:{field:[ue],list:[ce],map:[pe]}};if(!t?.root)throw new Error("bind needs at least options.root set");this.options=Object.assign({},n,t);let i=this.options.attribute,r=[i+"-field",i+"-list",i+"-map"],s=`[${i}-field],[${i}-list],[${i}-map]`,l=i+"-transform",a=o=>{let u=r.find(d=>o.hasAttribute(d));return u||console.error("No matching attribute found",o,attr),u},f=o=>{this.bindings.set(o,w(()=>{if(!o.isConnected){fe(o,this.getBindingPath(o)),q(this.bindings.get(o));return}let u={templates:o.querySelectorAll(":scope > template"),attribute:a(o)};u.path=this.getBindingPath(o),u.value=U(this.options.root,u.path),u.element=o,ae(o,u),p(u)},50))},p=o=>{let u;switch(o.attribute){case this.options.attribute+"-field":u=this.options.defaultTransformers.field||[];break;case this.options.attribute+"-list":u=this.options.defaultTransformers.list||[];break;case this.options.attribute+"-map":u=this.options.defaultTransformers.map||[];break}o.element.hasAttribute(l)&&o.element.getAttribute(l).split(" ").filter(Boolean).forEach(g=>{this.options.transformers[g]?u.push(this.options.transformers[g]):console.warn("No transformer with name "+g+" configured",{cause:o.element})});let d;for(let g of u)d=((C,ee)=>te=>ee.call(this,te,C))(d,g);d(o)},c=o=>{for(let u of o)this.bindings.get(u)||f(u)},h=o=>{let u=`[${i}-field],[${i}-list],[${i}-map]`;for(let d of o)if(d.type=="childList"&&d.addedNodes){for(let g of d.addedNodes)if(g instanceof HTMLElement){let C=Array.from(g.querySelectorAll(u));g.matches(u)&&C.unshift(g),C.length&&c(C)}}};this.observer=new MutationObserver(o=>{h(o)}),this.observer.observe(this.options.container,{subtree:!0,childList:!0});let y=this.options.container.querySelectorAll(":is(["+this.options.attribute+"-field],["+this.options.attribute+"-list],["+this.options.attribute+"-map]):not(template)");y.length&&c(y)}applyTemplate(t){let n=t.path,i=t.templates,r=t.list,s=t.index,l=t.parent,a=r?r[s]:t.value,f=this.findTemplate(i,a);if(!f){let o=new DocumentFragment;return o.innerHTML="<!-- no matching template -->",o}let p=f.content.cloneNode(!0);if(!p.children?.length)return p;if(p.children.length>1)throw new Error("template must contain a single root node",{cause:f});let c=this.options.attribute,h=[c+"-field",c+"-list",c+"-map"],y=p.querySelectorAll(`[${c}-field],[${c}-list],[${c}-map]`);for(let o of y){let u=h.find(g=>o.hasAttribute(g)),d=o.getAttribute(u);d.substring(0,6)==":root."?o.setAttribute(u,d.substring(6)):d==":value"&&s!=null?o.setAttribute(u,n+"."+s):s!=null?o.setAttribute(u,n+"."+s+"."+d):o.setAttribute(u,l+"."+d)}return typeof s<"u"&&p.children[0].setAttribute(c+"-key",s),Object.defineProperty(p.children[0],"$bindTemplate",{value:f,enumerable:!1,writable:!0,configurable:!0}),p}getBindingPath(t){let n=[this.options.attribute+"-field",this.options.attribute+"-list",this.options.attribute+"-map"];for(let i of n)if(t.hasAttribute(i))return t.getAttribute(i)}findTemplate(t,n){let i=l=>{let a=this.getBindingPath(l),f;a?a.substr(0,6)==":root."?f=U(this.options.root,a):f=U(n,a):f=n;let p=""+f,c=l.getAttribute(this.options.attribute+"-match");if(c){if(c===":empty"&&!f)return l;if(c===":notempty"&&f||p.match(c))return l}if(!c&&f!==null&&f!==void 0)return l},r=Array.from(t).find(i),s=r?.getAttribute("rel");if(s){let l=document.querySelector("template#"+s);if(!l)throw new Error("Could not find template with id "+s);r=l}return r}destroy(){this.bindings.forEach(t=>{q(t)}),this.bindings=new Map,this.observer.disconnect()}};function Z(e){return new V(e)}var O=new Map;function ae(e,t){O.has(t.path)?O.get(t.path).push(t):O.set(t.path,[t])}function fe(e,t){let n=O.get(t);n=n.filter(i=>i.element==e),O.set(t,n)}function I(e,t){return e==":empty"&&!t||t==":empty"&&!e||""+e==""+t}function U(e,t){let n=t.split("."),i=e,r,s;for(;n.length&&i;){if(r=n.shift(),r==":key")return s;if(r==":value")return i;r==":root"?i=e:(r=decodeURIComponent(r),i=i[r],s=r)}return i}function ue(e){let t=e.element,n=e.templates,i=n.length,r=e.path,s=e.value,l=this.options.attribute;if(n?.length)be.call(this,e);else switch(t.tagName){case"INPUT":ge.call(this,e);break;case"BUTTON":ye.call(this,e);break;case"SELECT":_.call(this,e);break;case"A":Se.call(this,e);break;case"IMG":Ae.call(this,contet);break;case"IFRAME":Te.call(this,e);break;case"META":ve.call(this,e);break;case"TEMPLATE":break;default:E.call(this,e);break}return e}function ce(e){let t=e.element,n=e.templates,i=n.length,r=e.path,s=e.value,l=this.options.attribute;return Array.isArray(s)?n?.length?he.call(this,e):console.error("No templates found in",t):console.error("Value is not an array.",t,r,s),e}function pe(e){let t=e.element,n=e.templates,i=n.length,r=e.path,s=e.value,l=this.options.attribute;return typeof s!="object"?console.error("Value is not an object.",t,r,s):n?.length?de.call(this,e):console.error("No templates found in",t),e}function he(e){let t=e.element,n=e.templates,i=n.length,r=e.path,s=e.value,l=this.options.attribute,a=t.querySelectorAll(":scope > ["+l+"-key]"),f=0,p=0;e.list=s;for(let h of a){let y=parseInt(h.getAttribute(l+"-key"));if(y>f)e.index=f,t.insertBefore(this.applyTemplate(e),h);else if(y<f)h.remove();else{let o=Array.from(h.querySelectorAll(`[${l}]`));h.matches(`[${l}]`)&&o.unshift(h);let u=o.find(d=>{let g=d.getAttribute(l);return g.substr(0,5)!==":root"&&g.substr(0,r.length)!==r});if(!u&&h.$bindTemplate){let d=this.findTemplate(n,s[f]);d!=h.$bindTemplate&&(u=!0,d||p++)}u&&(e.index=f,t.replaceChild(this.applyTemplate(e),h))}if(f++,f>=s.length)break}a=t.querySelectorAll(":scope > ["+l+"-key]");let c=a.length+p;if(c>s.length)for(;c>s.length;)t.querySelectorAll(":scope > :not(template)")?.[c-1]?.remove(),c--;else if(c<s.length)for(;c<s.length;)e.index=c,t.appendChild(this.applyTemplate(e)),c++}function de(e){let t=e.element,n=e.templates,i=n.length,r=e.path,s=e.value,l=this.options.attribute;e.list=s;let a=Array.from(t.querySelectorAll(":scope > ["+l+"-key]"));for(let f in e.list){e.index=f;let p=a.shift();if(!p){let h=this.applyTemplate(e);t.appendChild(h);continue}if(p.getAttribute[l+"-key"]!=f){a.unshift(p);let h=t.querySelector(":scope > ["+l+'-key="'+f+'"]');if(h)t.insertBefore(h,p),p=h,a=a.filter(y=>y!=h);else{let y=this.applyTemplate(e);t.insertBefore(y,p);continue}}if(this.findTemplate(n,s[f])!=p.$bindTemplate){let h=this.applyTemplate(e);t.replaceChild(h,p)}}for(;a.length;)a.shift().remove()}function me(e,t){let n=e.parentElement?.closest(`[${t}-list],[${t}-map]`);return n?n.hasAttribute(`${t}-list`)?n.getAttribute(`${t}-list`):n.getAttribute(`${t}-map`):":root"}function be(e){let t=e.element,n=e.templates,i=e.value,r=this.options.attribute,s=t.querySelector(":scope > :not(template)"),l=this.findTemplate(n,i);if(e.parent=me(t,r),s)if(l){if(s?.$bindTemplate!=l){let a=this.applyTemplate(e);t.replaceChild(a,s)}}else t.removeChild(s);else if(l){let a=this.applyTemplate(e);t.appendChild(a)}}function ge(e){let t=e.element,n=e.value;E(e),typeof n>"u"&&(n=""),t.type=="checkbox"||t.type=="radio"?I(t.value,n)?t.checked=!0:t.checked=!1:I(t.value,n)||(t.value=""+n)}function ye(e){let t=e.element,n=e.value;E(e),k(t,n,"value")}function _(e){let t=e.element,n=e.value;if(n===null&&(n=""),typeof n!="object")if(t.multiple){if(Array.isArray(n))for(let i of t.options)n.indexOf(i.value)===!1?i.selected=!1:i.selected=!0}else{let i=t.options.find(r=>I(r.value,n));i&&(i.selected=!0,i.setAttribute("selected",!0))}else n.options&&we(t,n.options),n.selected&&_(Object.asssign({},e,{value:n.selected})),k(t,n,"name","id","selectedIndex","className")}function Y(e,t){t&&(typeof t!="object"?e.options.add(new Option(""+t)):t.text?e.options.add(new Option(t.text,t.value,t.defaultSelected,t.selected)):typeof t.value<"u"&&e.options.add(new Option(""+t.value,t.value,t.defaultSelected,t.selected)))}function we(e,t){if(e.innerHTML="",Array.isArray(t))for(let n of t)Y(e,n);else if(t&&typeof t=="object")for(let n in t)Y(e,{text:t[n],value:n})}function Se(e){let t=e.element,n=e.value;E(e),k(t,n,"title","target","href","name","newwindow","nofollow")}function Ae(e){let t=e.element,n=e.value;E(e),k(t,n,"title","alt","src")}function Te(e){let t=e.element,n=e.value;E(e),k(t,n,"title","src")}function ve(e){let t=e.element,n=e.value;E(e),k(t,n,"content")}function E(e){let t=e.element,n=e.value;(typeof n>"u"||n==null)&&(n="");let i=""+n;if(typeof n!="object"||i.substring(0,8)!="[object "){t.innerHTML=i;return}k(t,n,"innerHTML","title","id","className")}function k(e,t,...n){if(!(!t||typeof t!="object"))for(let i of n)typeof t[i]>"u"||I(e[i],t[i])||(t[i]===null?e[i]="":e[i]=""+t[i])}var W={};D(W,{columns:()=>Be,filter:()=>Ce,model:()=>Ee,paging:()=>Me,scroll:()=>Oe,sort:()=>ke});var K=class{constructor(t){this.state=T(t),this.state.options||(this.state.options={}),this.effects=[{current:t.data}],this.view=T(t.data)}addEffect(t){let n=this.effects[this.effects.length-1];this.view=t.call(this,n),this.effects.push(this.view)}};function Ee(e){return new K(e)}function ke(e={}){return function(t){return this.state.options.sort=Object.assign({direction:"asc",sortBy:null,sortFn:(n,i)=>{let r=this.state.options.sort,s=r.sortBy;if(!r.sortBy)return 0;let l=r.direction=="asc"?1:-1,a=r.direction=="asc"?-1:1;return typeof n?.[s]>"u"?typeof i?.[s]>"u"?0:l:typeof i?.[s]>"u"||n[s]<i[s]?a:n[s]>i[s]?l:0}},e),w(()=>{let n=this.state.options.sort;return n?.sortBy&&n?.direction?t.current.toSorted(n?.sortFn):t.current},50)}}function Me(e={}){return function(t){return this.state.options.paging=Object.assign({page:1,pageSize:20,max:1},e),w(()=>H(()=>{let n=this.state.options.paging;n.pageSize||(n.pageSize=20),n.max=Math.ceil(this.state.data.length/n.pageSize),n.page=Math.max(1,Math.min(n.max,n.page));let i=(n.page-1)*n.pageSize,r=i+n.pageSize;return t.current.slice(i,r)}),50)}}function Ce(e){if(!e?.name||typeof e.name!="string")throw new Error("filter requires options.name to be a string");if(!e.matches||typeof e.matches!="function")throw new Error("filter requires options.matches to be a function");return function(t){if(this.state.options[e.name])throw new Error("a filter with this name already exists on this model");return this.state.options[e.name]=e,w(()=>this.state.options[e.name].enabled?t.current.filter(this.state.options[e.name].matches.bind(this)):t.current,50)}}function Be(e={}){if(!e||typeof e!="object"||Object.keys(e).length===0)throw new Error("columns requires options to be an object with at least one property");return function(t){return this.state.options.columns=e,w(()=>t.current.map(n=>{let i={};for(let r of Object.keys(this.state.options.columns))this.state.options.columns[r]?.hidden||(i[r]=n[r]);return i}),50)}}function Oe(e){return function(t){this.state.options.scroll=Object.assign({offset:0,rowHeight:26,rowCount:20,itemsPerRow:1,size:t.current.length},e);let n=this.state.options.scroll,i=n.scrollbar||n.container?.querySelector("[data-flow-scrollbar]");return i&&(n.container&&n.container.addEventListener("scroll",r=>{n.offset=Math.floor(n.container.scrollTop/(n.rowHeight*n.itemsPerRow))}),w(()=>{n.size=t.current.length*n.rowHeight,i.style.height=n.size+"px"},50)),w(()=>{n.container&&(n.rowCount=Math.ceil(n.container.getBoundingClientRect().height/n.rowHeight)),n.data=t.current;let r=Math.min(n.offset,t.current.length-1),s=r+n.rowCount;return s>t.current.length&&(s=t.current.length,r=s-n.rowCount),t.current.slice(r,s)},50)}}window.simply||(window.simply={});Object.assign(window.simply,{bind:Z,flow:W,state:F});var Re=window.simply;})();
//# sourceMappingURL=simply.flow.min.js.map
